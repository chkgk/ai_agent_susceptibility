{{ block title }}
    Header Demo 2
{{ endblock }}

{{ block content }}
<p>
    This page sends a request to https://headers.ckgk.de. The page returns the headers received from the client in JSON format. The returned values are shown below. This is a workaround for systems that allow JavaScript execution but do not provide the http headers received from the client natively.
</p>

<pre id="output">
    fetching...
</pre>
    
    {{ next_button }}
{{ endblock }}

{{ block scripts }}
<script>
    function fetchHeadersSync() {
        try {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://headers.ckgk.de', false); // false makes it synchronous
            xhr.send(null);

            if (xhr.status !== 200) {
                throw new Error(`HTTP error! status: ${xhr.status}`);
            }

            const data = JSON.parse(xhr.responseText);
            const outputEl = document.getElementById('output');
            if (outputEl) outputEl.textContent = '';

            // Print all headers
            Object.entries(data).forEach(([header, value]) => {
                const line = `${header}: ${value}`;
                console.log(line);
                if (outputEl) outputEl.textContent += line + '\n';
            });

            // Handle case with no headers
            if (outputEl && Object.keys(data).length === 0) {
                outputEl.textContent = 'No headers found.';
            }
        } catch (error) {
            console.error('Error fetching headers:', error);
        }
    }
    
    fetchHeadersSync();
</script>
{{ endblock scripts }}